



<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="drkless docs">
      
      
        <link rel="canonical" href="https://darkless.cn/my-docs/DVWA 文件包含(File Inclusion)/">
      
      
        <meta name="author" content="hand">
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="ja">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.1.2">
    
    
      
        <title>File Inclusion - DarkLess</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.3020aac5.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../assets/javascripts/modernizr.01ccdecf.js"></script>
    
    
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "None", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="deep-orange">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#_1" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://darkless.cn/my-docs/" title="DarkLess" class="md-header-nav__button md-logo">
          
            <i class="md-icon">book</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              DarkLess
            </span>
            <span class="md-header-nav__topic">
              File Inclusion
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href=".." title="首页" class="md-tabs__link">
        首页
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../DVWA暴力破解(Brute Force)/" title="DVWA解题" class="md-tabs__link md-tabs__link--active">
          DVWA解题
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://darkless.cn/my-docs/" title="DarkLess" class="md-nav__button md-logo">
      
        <i class="md-icon">book</i>
      
    </a>
    DarkLess
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="首页" class="md-nav__link">
      首页
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      DVWA解题
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        DVWA解题
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../DVWA暴力破解(Brute Force)/" title="Brute Force" class="md-nav__link">
      Brute Force
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../DVWA命令注入(Command Injection)/" title="Command Injection" class="md-nav__link">
      Command Injection
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../DVWA CSRF/" title="CSRF" class="md-nav__link">
      CSRF
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        File Inclusion
      </label>
    
    <a href="./" title="File Inclusion" class="md-nav__link md-nav__link--active">
      File Inclusion
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" title="文件包含简介" class="md-nav__link">
    文件包含简介
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" title="漏洞产生原因" class="md-nav__link">
    漏洞产生原因
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" title="本地文件包含" class="md-nav__link">
    本地文件包含
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" title="常见的敏感信息路径" class="md-nav__link">
    常见的敏感信息路径
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" title="远程文件包含" class="md-nav__link">
    远程文件包含
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#low" title="LOW等级" class="md-nav__link">
    LOW等级
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#medium" title="Medium等级" class="md-nav__link">
    Medium等级
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#high" title="High等级" class="md-nav__link">
    High等级
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#impossible" title="Impossible等级" class="md-nav__link">
    Impossible等级
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" title="参考文章：" class="md-nav__link">
    参考文章：
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../DVWA 文件上传(File Upload)/" title="File Upload" class="md-nav__link">
      File Upload
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../DVWA sql回显注入(sql injection)/" title="SQL Injection" class="md-nav__link">
      SQL Injection
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../DVWA sql盲注(sql blind injection)/" title="SQL Blind Injection" class="md-nav__link">
      SQL Blind Injection
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../DVWA 不安全的session ID（Weak Session IDs）/" title="Weak Session ID" class="md-nav__link">
      Weak Session ID
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../DVWA DOM型XSS(XSS-DOM)/" title="XSS-DOM" class="md-nav__link">
      XSS-DOM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../DVWA 反射型XSS（XSS-Reflected）/" title="XSS-Reflected" class="md-nav__link">
      XSS-Reflected
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" title="文件包含简介" class="md-nav__link">
    文件包含简介
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" title="漏洞产生原因" class="md-nav__link">
    漏洞产生原因
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" title="本地文件包含" class="md-nav__link">
    本地文件包含
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" title="常见的敏感信息路径" class="md-nav__link">
    常见的敏感信息路径
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" title="远程文件包含" class="md-nav__link">
    远程文件包含
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#low" title="LOW等级" class="md-nav__link">
    LOW等级
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#medium" title="Medium等级" class="md-nav__link">
    Medium等级
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#high" title="High等级" class="md-nav__link">
    High等级
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#impossible" title="Impossible等级" class="md-nav__link">
    Impossible等级
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" title="参考文章：" class="md-nav__link">
    参考文章：
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>File Inclusion</h1>
                
                <h2 id="_1">文件包含简介</h2>
<p>服务器执行PHP文件时，可以通过文件包含函数加载另一个文件中的PHP代码，并且当PHP来执行，这会为开发者节省大量的时间。这意味着您可以创建供所有网页引用的标准页眉或菜单文件。当页眉需要更新时，您只更新一个包含文件就可以了，或者当您向网站添加一张新页面时，仅仅需要修改一下菜单文件（而不是更新所有网页中的链接）。</p>
<p>在PHP中文件包含函数有以下四种：</p>
<ul>
<li>
<p>require()</p>
</li>
<li>
<p>require_once()</p>
</li>
<li>
<p>include()</p>
</li>
<li>
<p>include_once()</p>
</li>
</ul>
<p>include和require区别主要是，include在包含的过程中如果出现错误，会抛出一个警告，程序继续正常运行；而require函数出现错误的时候，会直接报错并退出程序的执行。</p>
<p>而include_once()，require_once()这两个函数，与前两个的不同之处在于这两个函数只包含一次，适用于在脚本执行期间同一个文件有可能被包括超过一次的情况下，你想确保它只被包括一次以避免函数重定义，变量重新赋值等问题。</p>
<h2 id="_2">漏洞产生原因</h2>
<p>件包含函数加载的参数没有经过过滤或者严格的定义，可以被用户控制，包含其他恶意文件，导致了执行了非预期的代码。</p>
<p>示例代码</p>
<pre><code class="php">
&lt;?php

$filename  =  $_GET['filename'];

include($filename);

?&gt;
</code></pre>

<p><code>$_GET['filename']</code>参数开发者没有经过严格的过滤，直接带入了include的函数，攻击者可以修改<code>$_GET['filename']</code>的值，执行非预期的操作。</p>
<h2 id="_3">本地文件包含</h2>
<p>本地文件包含指的是可以执行windows或者linux下的敏感文件，这些文件一般不是PHP，执行这些文件可以直接显示出文件中的内容</p>
<h3 id="_4">常见的敏感信息路径</h3>
<p>windows系统：</p>
<pre><code class="text">
c:\boot.ini // 查看系统版本



c:\windows\system32\inetsrv\MetaBase.xml // IIS配置文件



c:\windows\repair\sam // 存储Windows系统初次安装的密码



c:\ProgramFiles\mysql\my.ini // MySQL配置



c:\ProgramFiles\mysql\data\mysql\user.MYD // MySQL root密码



c:\windows\php.ini // php 配置信息
</code></pre>

<p>linux系统：</p>
<pre><code class="text">
/etc/passwd // 账户信息



/etc/shadow // 账户密码文件



/usr/local/app/apache2/conf/httpd.conf // Apache2默认配置文件



/usr/local/app/apache2/conf/extra/httpd-vhost.conf // 虚拟网站配置



/usr/local/app/php5/lib/php.ini // PHP相关配置



/etc/httpd/conf/httpd.conf // Apache配置文件



/etc/my.conf // mysql 配置文件
</code></pre>

<h2 id="_5">远程文件包含</h2>
<p>PHP的配置文件<code>allow_url_fopen</code>和<code>allow_url_include</code>设置为ON，<code>include/require</code>等包含函数可以加载远程文件，如果远程文件没经过严格的过滤，导致了执行恶意文件的代码，这就是远程文件包含漏洞。</p>
<blockquote>
<p>allow_url_fopen = On（是否允许打开远程文件）</p>
<p>allow_url_include = On（是否允许include/require远程文件）</p>
</blockquote>
<h2 id="low">LOW等级</h2>
<p>先测试下LOW等级是否有本地文件包含漏洞：</p>
<p>点击页面上的<code>file1.php</code>查看链接为：<code>http://127.0.0.1/dvwa/vulnerabilities/fi/?page=file1.php</code></p>
<p>尝试随便将链接更改一个不存在的文件，显示如下，将服务器的绝对路径也爆了出来。</p>
<p><img alt="20190427225212.png" src="https://raw.githubusercontent.com/handbye/images/master/20190427225212.png" /></p>
<p>在服务器根目录下存在一个phpinfo文件，经过测试可以包含此文件：</p>
<p><img alt="20190427225941.png" src="https://raw.githubusercontent.com/handbye/images/master/20190427225941.png" /></p>
<p>当然一般情况下很难爆出绝对路径，要靠去不断的猜测，当有本地文件包含漏洞时，可以和文件上传漏洞配合使用，上传一个大马getshell。</p>
<p>接下来测试是否可以远程包含：</p>
<p><img alt="20190427233614.png" src="https://raw.githubusercontent.com/handbye/images/master/20190427233614.png" /></p>
<p>发现也可以远程包含，那这样就不用去上传文件执行了，我们写个木马放到远程服务器直接执行就可以了。</p>
<h2 id="medium">Medium等级</h2>
<p>同样和Low等级一样测试能否本地包含和远程包含。</p>
<p><img alt="20190427232516.png" src="https://raw.githubusercontent.com/handbye/images/master/20190427232516.png" /></p>
<p>可以本地包含。</p>
<p><img alt="20190427233815.png" src="https://raw.githubusercontent.com/handbye/images/master/20190427233815.png" /></p>
<p>远程包含报错，猜测可能是服务器代码对包含的参数加了过滤，仔细分析报错可发现手工加的远程文件链接中的<code>http://</code>不见了，猜测可能是对<code>http://</code>加了过滤。</p>
<p>重新构造链接，查看能否被包含：</p>
<p><img alt="20190427234418.png" src="https://raw.githubusercontent.com/handbye/images/master/20190427234418.png" /></p>
<p>文件执行成功。</p>
<p>查看源码果然是对http://和https://进行了过滤，所以我们要善于观察。</p>
<p><img alt="20190427234559.png" src="https://raw.githubusercontent.com/handbye/images/master/20190427234559.png" /></p>
<h2 id="high">High等级</h2>
<p>High等级下，使用前面的办法都无法执行。</p>
<p><img alt="20190427234834.png" src="https://raw.githubusercontent.com/handbye/images/master/20190427234834.png" /></p>
<p>直接提示<code>ERROR: File not found!</code></p>
<p>那为什么执行file1.php,file2.php,file3.php可以正常执行呢？</p>
<p>我们执行file10.php,发现报错信息和之前不一样了，猜测可能是只有file开头的文件才可以执行。</p>
<p><img alt="20190427235213.png" src="https://raw.githubusercontent.com/handbye/images/master/20190427235213.png" /></p>
<p>此时就无法使用远程文件包含了，而file开头的正是一种文件访问的格式，可以利用这一点去访问本地文件，但前提要知道此文件的绝对路径，这就必须配合后面的文件上传漏洞一起利用了。</p>
<p>查看源代码，发现也是如此：</p>
<p><img alt="20190427235519.png" src="https://raw.githubusercontent.com/handbye/images/master/20190427235519.png" /></p>
<h2 id="impossible">Impossible等级</h2>
<p>Impossible等价下对访问的文件做了白名单，其余任意文件都无法访问，这就有效避免了文件包含漏洞的产生。</p>
<p>代码如下：</p>
<p><img alt="20190427235725.png" src="https://raw.githubusercontent.com/handbye/images/master/20190427235725.png" /></p>
<h2 id="_6">参考文章：</h2>
<p><a href="https://www.freebuf.com/articles/web/182280.html">https://www.freebuf.com/articles/web/182280.html</a></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../DVWA CSRF/" title="CSRF" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  后退
                </span>
                CSRF
              </span>
            </div>
          </a>
        
        
          <a href="../DVWA 文件上传(File Upload)/" title="File Upload" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  前进
                </span>
                File Upload
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy;2019 darkless
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="http://darkless.cn" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://github.com/handbye" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://weibo.com/handbye" class="md-footer-social__link fa fa-weibo"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.267712eb.js"></script>
      
        
        
          
          <script src="../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
                <script src="../assets/javascripts/lunr/tinyseg.js"></script>
              
              
                <script src="../assets/javascripts/lunr/lunr.ja.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>